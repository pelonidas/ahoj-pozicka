<% layout('./layouts/form-boilerplate') %>
<section class="mt-auto form-container pb-[4.5rem] lg:py-[9rem]">
    <div class="flex flex-col md:grid grid-cols-2 md:gap-24 text-secondary">
        <div class="bg-white p-6 md:p-12 rounded-lg">
            <form action="/form/step-4" method="post">
                <div class="flex items-center mb-8">
                    <img src="/images/step4-id.svg" alt="">
                    <h3 class="ml-4 text-[1.25rem] md:text-xl font-bold leading-tight">Občiansky preukaz z prednej aj
                        zadnej strany</h3>
                </div>
                <div class="flex items-center">
                    <img src="/images/step4-doc.svg" alt="">
                    <div class="flex flex-col items-start ml-4">
                        <h3 class="text-[1.25rem] font-bold md:text-xl">Doklad o príjme</h3>
                        <p class="text-[0.8rem] md:text-xs text-secondary/50">
                            Ak dostávate výplatu na účet, stačí mi snímka obrazovky vášho internet bankingu. Inak
                            potrebujem
                            posledné 3 výplatné pásky a výpis z účtu za posledný mesiac.
                        </p>
                    </div>
                </div>
                <hr class="my-12">



                <div class="mb-6 flex md:items-center front-container">
                    <div class="">
                        <label for="frontObciansky"
                               class=" flex cursor-pointer h-[90px] w-[160px] rounded-[10px] custom-stroke">
                        <span class="flex m-auto items-center">
                            <img src="/images/icons/rounded-plus.svg" alt="" class="w-full max-w-[25px]">
                            <span class="flex flex-col ml-2">
                                <span class="text-[0.75rem] font-bold">Pridať súbory</span>
                                <span class="text-[0.5rem] leading-[10px]">PNG, JPG, PDF</span>
                            </span>
                        </span>
                        </label>
                        <input type="file" id="frontObciansky" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                    </div>
                    <div class="img-container test relative overflow-hidden img-upload-wrapper">
                        <img src="#" alt=""
                             class="w-full md:max-w-[160px] hidden rounded-[10px]  front-img absolute top-[50%] -translate-y-1/2">
                        <div class="absolute bottom-0 top-0 left-0 right-0 m-auto text-center h-[23px] w-[19px] trash transition ease-in-out duration-200">
                            <img src="/images/icons/trash.svg" alt="" class="">
                        </div>
                    </div>
                    <div class="vl md:mx-[2rem]"></div>
                    <div class="flex flex-col w-full md:max-w-[205px]">
                        <h4 class="text-[1.25rem] font-bold md:leading-[23px] md:mb-[0.2rem]">Predna strana Občiansky
                            preukaz</h4>
                        <span class="font-bold md:text-[0.875rem] text-secondary/70 md:leading-[15px]">(max 5MB)</span>
                    </div>
                </div>

                <div class="mb-6 flex md:items-center back-container">
                    <div>
                        <label for="backObciansky"
                               class=" flex cursor-pointer h-[90px] w-[160px] rounded-[10px] custom-stroke">
                        <span class="flex m-auto items-center">
                            <img src="/images/icons/rounded-plus.svg" alt="" class="w-full max-w-[25px]">
                            <span class="flex flex-col ml-2">
                                <span class="text-[0.75rem] font-bold">Pridať súbory</span>
                                <span class="text-[0.5rem] leading-[10px]">PNG, JPG, PDF</span>
                            </span>
                        </span>
                        </label>
                        <input type="file" id="backObciansky" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                    </div>
                    <div class="img-container test relative overflow-hidden img-upload-wrapper">
                        <img src="#" alt=""
                             class="w-full md:max-w-[160px] hidden rounded-[10px]  back-img absolute top-[50%] -translate-y-1/2">
                        <div class="absolute bottom-0 top-0 left-0 right-0 m-auto text-center h-[23px] w-[19px] trash transition ease-in-out duration-200">
                            <img src="/images/icons/trash.svg" alt="" class="">
                        </div>
                    </div>
                    <div class="vl md:mx-[2rem]"></div>
                    <div class="flex flex-col w-full md:max-w-[205px]">
                        <h4 class="text-[1.25rem] font-bold md:leading-[23px] md:mb-[0.2rem]">Zadna strana Občiansky
                            preukaz</h4>
                        <span class="font-bold md:text-[0.875rem] text-secondary/70 md:leading-[15px]">(max 5MB)</span>
                    </div>
                </div>


                <div class="mb-8 flex md:items-center doklady-container">
                    <div class="order-1">
                        <label for="doklady"
                               class=" flex cursor-pointer h-[90px] w-[160px] rounded-[10px] custom-stroke">
                        <span class="flex m-auto items-center">
                            <img src="/images/icons/rounded-plus.svg" alt="" class="w-full max-w-[25px]">
                            <span class="flex flex-col ml-2">
                                <span class="text-[0.75rem] font-bold">Pridať súbory</span>
                                <span class="text-[0.5rem] leading-[10px]">PNG, JPG, PDF</span>
                            </span>
                        </span>
                        </label>
                        <input type="file" id="doklady" class="hidden" accept=".pdf,.jpg,.jpeg,.png" multiple>
                    </div>
                    <div class="ml-[1.5rem] additional-input-container hidden">
                        <label for="additionalFile" class="flex w-full h-[88px] w-[64px] custom-stroke items-center justify-center">
                            <img src="/images/icons/rounded-plus.svg" alt="" class="w-full max-w-[25px] ">
                        </label>
                        <input type="file" id="additionalFile" class="hidden additional-input">
                    </div>
                    <div class="img-container test relative overflow-hidden">
                        <img src="#" alt=""
                             class="w-full md:max-w-[160px] hidden rounded-[10px] doklady-img absolute top-[50%] -translate-y-1/2">
                        <div class="absolute bottom-0 top-0 left-0 right-0 m-auto text-center h-[23px] w-[19px] trash transition ease-in-out duration-200">
                            <img src="/images/icons/trash.svg" alt="" class="">
                        </div>
                    </div>
                    <div class="vl md:mx-[2rem] order-3"></div>
                    <div class="flex flex-col w-full md:max-w-[220px] order-4">
                        <h4 class="text-[1.25rem] font-bold md:leading-[23px] md:mb-[0.2rem]">Doklady o príjme 0/3</h4>
                        <span class="font-bold md:text-[0.875rem] text-secondary/70 md:leading-[15px]">(1 súbor max 2MB)</span>
                    </div>
                </div>
                <button class="border-2 border-dRed rounded-lg py-1.5 px-7">Odoslať na posúdenie</button>
            </form>
        </div>
        <div class="translate-y-[560px] md:translate-y-0 bottom-nav bottom-nav-fixed bottom-nav-container md:h-[45rem]">
            <div class="md:hidden buttonContainer">
                <div class="bg-transparent">
                    <img src="/images/icons/mobile-up.svg" alt=""
                         class="w-full max-w-[59px] mx-auto cursor-pointer translate-y-[70%] bottom-nav-button">
                </div>
                <div class="flex flex-col h-[54px] rounded-t-[10px] bg-secondary">
                    <div class="m-auto z-40">
                        <span class="font-light leading-[17px] text-[1.125rem]">Tebou vyplnené údaje</span>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
<script>
    const frontInput = document.querySelector('#frontObciansky');
    const frontContainer = document.querySelector('.front-container');
    const frontImage = document.querySelector('.front-img')

    const backInput = document.querySelector('#backObciansky');
    const backContainer = document.querySelector('.back-container');
    const backImage = document.querySelector('.back-img')

    const dokladyInput = document.querySelector('#doklady')
    const dokladyContainer = document.querySelector('.doklady-container')
    const dokladyImage = document.querySelector('.doklady-img')


    const removeFileFromFileList = (fileInput, index) => {
        const dt = new DataTransfer()
        const {files} = fileInput

        for (let i = 0; i < files.length; i++) {
            const file = files[i]
            if (index !== i)
                dt.items.add(file) // here you exclude the file. thus removing it.
        }

        fileInput.files = dt.files // Assign the updates list
    }

    let handleFileInput = (fileInput, container, image) => {
        fileInput.onchange = () => {
            const [file] = fileInput.files;

            if (file) {
                if (file.size < 5_000_000) {
                    const containerChild = container.firstElementChild;
                    const imgContainer = container.querySelector('.img-container');
                    // w-[160px] h-[90px]  border-2 border-secondary
                    imgContainer.classList.add('w-[160px]', 'h-[90px]', 'border-2', 'border-secondary', 'rounded-[10px]')
                    image.src = URL.createObjectURL(file);
                    image.classList.toggle('hidden');
                    containerChild.classList.add('hidden')
                    const icons = container.querySelectorAll('.trash')
                    for (const icon of icons) {
                        icon.classList.remove('hidden')
                        icon.addEventListener('click', () => {
                            imgContainer.classList.remove('w-[160px]', 'h-[90px]', 'border-2', 'border-secondary', 'rounded-[10px]')
                            removeFileFromFileList(fileInput, 0)
                            image.src = '';
                            image.classList.add('hidden')
                            containerChild.classList.remove('hidden')
                            icon.classList.add('hidden')
                        })
                    }
                }
            }
        }
    }

    let handleMultipleInput = (fileInput, container, image) => {
        const additionalInputContainer = container.querySelector('.additional-input-container')
        const additionalInput = container.querySelector('.additional-input')
        let data = [];
        let files = Array.from(fileInput.files)
        let [additionalFile] = additionalInput.files

        additionalInput.onchange = () => {
            if (data.length < 3 ) {
                if (additionalFile) {
                    // console.log(additionalFiles)
                    data.push(additionalFile)
                    console.log(data)
                    if (data.length === 3) {
                        additionalInputContainer.classList.toggle('hidden')
                    }
                }
            }
        }

        fileInput.onchange = () => {
            // const additionalInput = container.querySelector('.additional-input');
            // if (additionalInput) {
            //     let filesArray = Array.from(files)
            //     if (additionalInput.files) {
            //         filesArray.push(Array.from(additionalInput.files));
            //         console.log(filesArray)
            //     }
            //     console.log(filesArray)
            // }
            if (files) {
                console.log(files)
                data.push(...Array.from(files))
                // console.log(data.length)
                // console.log(data)
                if (data.length < 3 || files.length < 3) {
                    additionalInputContainer.classList.toggle('hidden')
                    additionalInputContainer.classList.add('order-2')
                } else {
                    additionalInputContainer.classList.add('hidden')
                }
                const containerChild = container.firstElementChild;
                const imgContainer = container.querySelector('.img-container');

                imgContainer.classList.add('w-[160px]', 'h-[90px]', 'border-2', 'border-secondary', 'rounded-[10px]')
                image.src = URL.createObjectURL(data[0])
                image.classList.toggle('hidden');
                containerChild.classList.add('hidden')
                const icons = container.querySelectorAll('.trash')
                for (const icon of icons) {
                    icon.classList.remove('hidden')
                    icon.addEventListener('click', () => {
                        imgContainer.classList.remove('w-[160px]', 'h-[90px]', 'border-2', 'border-secondary', 'rounded-[10px]')
                        removeFileFromFileList(additionalInput, 0)
                        fileInput.value = null
                        data = []

                        image.src = '';
                        image.classList.add('hidden')
                        containerChild.classList.remove('hidden')
                        icon.classList.add('hidden')
                        additionalInputContainer.classList.add('hidden')

                    })
                }
            }

        }
    }


    handleFileInput(frontInput, frontContainer, frontImage)
    handleFileInput(backInput, backContainer, backImage)
    handleMultipleInput(dokladyInput, dokladyContainer, dokladyImage)
</script>